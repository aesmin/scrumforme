{{extend 'default/layout_base.html'}}

<script>
    // OBS: other global variables are generated on the page project
    var url = {
        changeAjaxItens : '{{=URL("board_ajax_itens")}}',
    };
</script>

<div id="target_ajax"></div>

<div id="sub-header-content">
    <div id="content-header">
        <div id="breadcrumb">
            <a href='{{=URL("index")}}' title="{{=T('Go to')}} {{=T('Home')}}" class="tip-bottom"><i class="icon-home"></i> Home</a>
            <a href='{{=URL("projects")}}' title="{{=T('Go to')}} {{=T('Board')}}" class="tip-bottom"><i class="icon icon-th"></i> {{=T('Board')}}</a>
            <a href="#" class="current">{{=T('Board')}}</a>
        </div>
        <div id="header-name" class="pull-left">
            <h1>{{=project.name}}</h1>
        </div>
        <div id="project_info" class="pull-left">
            <p>{{=project.description}}</p>
            <p>{{=project.date_.strftime("%d/%m/%Y")}} <a href="{{=project.url}}" target="_blank">{{=project.url}}</a></p>
        </div>
        <div id="live_search" class="pull-right">
                <p>
                    <input type="text" name="livesearch" placeholder='{{=T("Search on Sprint")}}' alt='{{=T("Search on Sprint")}}' title='{{=T("Search on Sprint")}}'>

                <p id="nothingfound">{{=T("No name match your search!")}}</p>
        </div>
        <div class="clearfix"></div>
    </div>
</div>

<div class="nav-status">
    <div class="column">
        <h4>{{=T('Definition of Ready')}}</h4>
    </div>
    <div class="column">
        <h4>{{=T('To Do')}}</h4>
    </div>
    <div class="column">
        <h4>{{=T('In Progress')}}</h4>
    </div>
    <div class="column">
        <h4>{{=T('Verification')}}</h4>
    </div>
    <div class="column">
        <h4>{{=T('Done')}}</h4>
    </div>
</div>


{{if "stories" in globals():}}
    {{for story in stories:}}
        {{if story.sprint_id == sprint.id: }}
        <table class="table" data-storyid='{{=story.id}}'>
            <tr>
                <th class="story_title" colspan=5>
                    <h5>{{=story.title}}</h5>
                </th>
            </tr>
            <tr>
            {{count = 0}}
            {{for df in definition_ready[story.id]:}}
                {{if definition_ready[story.id][count].story_id == story.id:}}
                <td class="definition_ready_title">
                    {{=definition_ready[story.id][count].title}}
                    {{print definition_ready[story.id][count].story_id}}
                </td>
                
                <td class="column_task" data-status="todo">
                    {{for task in tasks[definition_ready[story.id][count].id]:}}
                        {{if task["status"] == "todo": }}
                        <ul class="task_container" data-taskid='{{=task["id"]}}'>
                          <li class="task">
                            <a href="#" class="content">{{=task["title"]}}</a>
                            <img src='{{=Gravatar(auth.user.email).thumb}}' width="30px" height="30px">
                            <div class="clearfix"></div>
                            <div>
                                <span class="icon-comment"></span>
                            </div>
                          </li>
                        </ul>
                        {{pass}}
                    {{pass}}
                </td>
                
                <td class="column_task" data-status="inprogress">
                    {{for task in tasks[definition_ready[story.id][count].id]:}}
                        {{if task["status"] == "inprogress": }}
                        <ul class="task_container" data-taskid='{{=task["id"]}}'>
                          <li class="task">
                            <a href="#">{{=task["title"]}}</a>
                            <img src='{{=Gravatar(auth.user.email).thumb}}' width="30px" height="30px">
                            <div class="clearfix"></div>
                            <div>
                                <span class="icon-comment"></span>
                            </div>
                          </li>
                        </ul>
                        {{pass}}
                    {{pass}}
                </td>
                
                <td class="column_task" data-status="verification">
                    {{for task in tasks[definition_ready[story.id][count].id]:}}
                        {{if task["status"] == "verification": }}
                        <ul class="task_container" data-taskid='{{=task["id"]}}'>
                          <li class="task">
                            <a href="#">{{=task["title"]}}</a>
                            <img src='{{=Gravatar(auth.user.email).thumb}}' width="30px" height="30px">
                            <div class="clearfix"></div>
                            <div>
                                <span class="icon-comment"></span>
                            </div>
                          </li>
                        </ul>
                        {{pass}}
                    {{pass}}
                </td>
                
                <td class="column_task" data-status="done">
                    {{for task in tasks[definition_ready[story.id][count].id]:}}
                        {{if task["status"] == "done": }}
                        <ul class="task_container" data-taskid='{{=task["id"]}}'>
                          <li class="task">
                            <a href="#">{{=task["title"]}}</a>
                            <img src='{{=Gravatar(auth.user.email).thumb}}' width="30px" height="30px">
                            <div class="clearfix"></div>
                            <div>
                                <span class="icon-comment"></span>
                            </div>
                          </li>
                        </ul>
                        {{pass}}
                    {{pass}}
                </td>

                {{pass}}
                {{count += 1}}
            {{pass}}
            </tr>
        </table>
        {{pass}}
    {{pass}}
{{pass}}

