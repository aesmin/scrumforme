{{extend 'default/layout_base.html'}}

<script>
    // OBS: other global variables are generated on the page project
    var url = {
        createUpdateBacklogItens : '{{=URL("create_update_backlog_itens.json")}}',
        changeAjaxItens : '{{=URL("board_ajax_itens")}}',
    },
    msg = {
        field_empty : '{{=T("Click to write")}}',
        validation_error : '{{=T("Can not be empty")}}',
        confirm : '{{=T("Are you sure you want to continue?")}}',
        remove_sucess : '{{=T("Removed Successfully!")}}',
        remove_error : '{{=T("Error in removal!")}}',
        type_error : 'error',
        type_success : 'success',
    }
</script>

<div id="target_ajax"></div>

<div id="sub-header-content">
    <div id="content-header">
        <div id="breadcrumb">
            <a href='{{=URL("index")}}' title="{{=T('Go to')}} {{=T('Home')}}" class="tip-bottom"><i class="icon-home"></i> Home</a>
            <a href='{{=URL("projects")}}' title="{{=T('Go to')}} {{=T('Board')}}" class="tip-bottom"><i class="icon icon-th"></i> {{=T('Board')}}</a>
            <a href="#" class="current">{{=T('Board')}}</a>
        </div>
        <div id="header-name" class="pull-left">
            <h1>{{=project.name}}</h1>
        </div>
        <div class="clearfix"></div>
    </div>
</div>

<div id="info_content" class="row-fluid">
    <div id="project_info" class="span4">
        <p>{{=project.description}}</p>
        <p>{{=project.date_.strftime("%d/%m/%Y")}} <a href="{{=project.url}}" target="_blank">{{=project.url}}</a></p>
    </div>
    <div id="time_sprint" class="span4">
        <div id="clock">
            <i class="icon-time pull-left"></i>
            <div class="pull-left">
                {{if sprint.started:}}
                <p>{{=T('Started in')}}: <strong>{{=g_blank_check(sprint.started.strftime("%d/%m/%Y"))}}</strong></p>
                {{else:}}
                <p>{{=T('Started in')}}: <strong>00/00/00</strong></p>
                {{pass}}

                {{if sprint.ended:}}
                <p>{{=T('Estimated for')}}: <strong>{{=g_blank_check(sprint.ended.strftime("%d/%m/%Y"))}}</strong></p>
                {{else:}}
                <p>{{=T('Estimated for')}}: <strong>00/00/00</strong></p>
                {{pass}}
            </div>
            <div class="clearfix"></div>
        </div>
    </div>
    <div id="live_search" class="span3">
        <input type="text" name="livesearch" placeholder='{{=T("Search on Sprint")}}' alt='{{=T("Search on Sprint")}}' title='{{=T("Search on Sprint")}}'>
        <p id="nothingfound">{{=T("No name match your search!")}}</p>
    </div>
</div>

<div class="nav-status">
    <div class="column">
        <h4>{{=T('Definition of Ready')}}</h4>
    </div>
    <div class="column">
        <h4>{{=T('To Do')}}</h4>
    </div>
    <div class="column">
        <h4>{{=T('In Progress')}}</h4>
    </div>
    <div class="column">
        <h4>{{=T('Verification')}}</h4>
    </div>
    <div class="column">
        <h4>{{=T('Done')}}</h4>
    </div>
</div>

{{definition_ids =[]}}
{{if "stories" in globals():}}
    {{for story in stories:}}
        {{if story.sprint_id == sprint.id: }}
            {{count = 0}}
            {{for df in definition_ready[story.id]:}}
                {{if definition_ready[story.id][count].story_id == story.id:}}
                {{if not definition_ready[story.id][count].story_id in definition_ids:}}
                <table class="table" data-storyid='{{=definition_ready[story.id][count].id}}'>
                    <tr>
                        <th class="story_title" colspan=5>
                            <h5><a href="#" class="editable-click story_card editable" data-type="text" data-placeholder="Click para escrever" data-pk="{{=story.id}}" data-url="{{=URL('create_update_backlog_itens.json')}}" data-name="story" data-update="true">{{=story.title}}</a></h5>
                        </th>
                    </tr>
                    {{definition_ids.append(definition_ready[story.id][count].story_id)}}
                {{else:}}
                <table class="table no-th" data-storyid='{{=definition_ready[story.id][count].id}}'>
                {{pass}}
                    <tr>
                        <td class="definition_ready_title">
                            {{=definition_ready[story.id][count].title}}
                        </td>
                        
                        <td class="column_task" data-status="todo">
                            {{for task in tasks[definition_ready[story.id][count].id]:}}
                                {{if task["status"] == "todo": }}
                                <ul class="task_container" data-taskid='{{=task["id"]}}'>
                                  <li class="task">
                                    <a href="#" class="editable-click editable" data-type="textarea" data-pk='{{=task["id"]}}' data-url="{{=URL('create_update_backlog_itens.json')}}" data-name="task" data-update="true">{{=task["title"]}}</a>
                                    <img src='{{=Gravatar(auth.user.email).thumb}}' width="30px" height="30px">
                                    <div class="clearfix"></div>
                                    <div>
                                        <span class="icon-comment"></span>
                                    </div>
                                  </li>
                                </ul>
                                {{pass}}
                            {{pass}}
                        </td>
                        
                        <td class="column_task" data-status="inprogress">
                            {{for task in tasks[definition_ready[story.id][count].id]:}}
                                {{if task["status"] == "inprogress": }}
                                <ul class="task_container" data-taskid='{{=task["id"]}}'>
                                  <li class="task">
                                    <a href="#" class="editable-click editable" data-type="textarea" data-pk='{{=task["id"]}}' data-url="{{=URL('create_update_backlog_itens.json')}}" data-name="task" data-update="true">{{=task["title"]}}</a>
                                    <img src='{{=Gravatar(auth.user.email).thumb}}' width="30px" height="30px">
                                    <div class="clearfix"></div>
                                    <div>
                                        <span class="icon-comment"></span>
                                    </div>
                                  </li>
                                </ul>
                                {{pass}}
                            {{pass}}
                        </td>
                        
                        <td class="column_task" data-status="verification">
                            {{for task in tasks[definition_ready[story.id][count].id]:}}
                                {{if task["status"] == "verification": }}
                                <ul class="task_container" data-taskid='{{=task["id"]}}'>
                                  <li class="task">
                                    <a href="#" class="editable-click editable" data-type="textarea" data-pk='{{=task["id"]}}' data-url="{{=URL('create_update_backlog_itens.json')}}" data-name="task" data-update="true">{{=task["title"]}}</a>
                                    <img src='{{=Gravatar(auth.user.email).thumb}}' width="30px" height="30px">
                                    <div class="clearfix"></div>
                                    <div>
                                        <span class="icon-comment"></span>
                                    </div>
                                  </li>
                                </ul>
                                {{pass}}
                            {{pass}}
                        </td>
                        
                        <td class="column_task" data-status="done">
                            {{for task in tasks[definition_ready[story.id][count].id]:}}
                                {{if task["status"] == "done": }}
                                <ul class="task_container" data-taskid='{{=task["id"]}}'>
                                  <li class="task">
                                    <a href="#" class="editable-click editable" data-type="textarea" data-pk='{{=task["id"]}}' data-url="{{=URL('create_update_backlog_itens.json')}}" data-name="task" data-update="true">{{=task["title"]}}</a>
                                    <img src='{{=Gravatar(auth.user.email).thumb}}' width="30px" height="30px">
                                    <div class="clearfix"></div>
                                    <div>
                                        <span class="icon-comment"></span>
                                    </div>
                                  </li>
                                </ul>
                                {{pass}}
                            {{pass}}
                        </td>

                        {{count += 1}}
                        {{pass}}
                    {{pass}}
                </tr>
            </table>
        {{pass}}
    {{pass}}
{{pass}}

